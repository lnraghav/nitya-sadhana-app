<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Nitya Sadhana â€“ Japa</title>

<style>
body {
  font-family: Arial, sans-serif;
  text-align: center;
  padding: 40px;
  background-color: #f4f0e6;
}

h1 {
  font-size: 28px;
}

#count {
  font-size: 80px;
  margin: 30px 0;
}

button {
  font-size: 18px;
  padding: 12px 24px;
  margin: 10px;
  border-radius: 8px;
  border: none;
  background: #8b6f47;
  color: white;
}

button:active {
  background: #6f5736;
}
</style>
</head>

<body>

<h1>Nitya Sadhana â€“ Japa</h1>

<div id="count">0</div>
<div>Target: 108</div>

<br>

<button onclick="tap()">Tap</button>
<button onclick="resetCount()">Reset</button>

<br><br>

<button onclick="startMantra()">ðŸ•‰ Play Mantra</button>
<button onclick="stopMantra()">â–  Stop</button>

<script>
let count = 0;
let audioContext = null;
let mantraOscillator = null;

// Ensure AudioContext is active (Safari requirement)
function initAudio() {
  if (!audioContext) {
    audioContext = new (window.AudioContext || window.webkitAudioContext)();
  }
  if (audioContext.state === "suspended") {
    audioContext.resume();
  }
}

// Bell sound on tap
function playBell() {
  initAudio();

  const oscillator = audioContext.createOscillator();
  const gain = audioContext.createGain();

  oscillator.type = "sine";
  oscillator.frequency.value = 880;

  gain.gain.setValueAtTime(0.5, audioContext.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.4);

  oscillator.connect(gain);
  gain.connect(audioContext.destination);

  oscillator.start();
  oscillator.stop(audioContext.currentTime + 0.4);
}

// Continuous mantra
function startMantra() {
  initAudio();

  if (mantraOscillator) return;

  mantraOscillator = audioContext.createOscillator();
  const gain = audioContext.createGain();

  mantraOscillator.type = "sine";
  mantraOscillator.frequency.value = 432;

  gain.gain.value = 0.2;

  mantraOscillator.connect(gain);
  gain.connect(audioContext.destination);

  mantraOscillator.start();
}

function stopMantra() {
  if (mantraOscillator) {
    mantraOscillator.stop();
    mantraOscillator = null;
  }
}

// Tap function
function tap() {
  count++;
  document.getElementById("count").innerText = count;
  playBell();
}

function resetCount() {
  count = 0;
  document.getElementById("count").innerText = count;
}
</script>

</body>
</html>
