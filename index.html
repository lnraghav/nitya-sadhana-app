<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport"
content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Sadhana Bharat</title>

<style>
body {
  font-family: -apple-system, Arial;
  background: #f4f0e6;
  text-align: center;
  padding: 20px;
}

h1 { margin-bottom: 5px; }

.section { margin-top: 25px; }

#count {
  font-size: 72px;
  margin: 20px 0;
}

button {
  font-size: 18px;
  padding: 14px 24px;
  margin: 10px;
  border-radius: 12px;
  border: none;
  background: #8b6f47;
  color: white;
  width: 80%;
  max-width: 300px;
}

input {
  font-size: 16px;
  padding: 6px;
  margin: 6px;
  width: 70px;
}

#breathCircle {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  background: #8b6f47;
  margin: 20px auto;
  transition: transform 4s ease-in-out;
}
</style>
</head>

<body>

<h1>ðŸ‡®ðŸ‡³ Sadhana Bharat</h1>

<div class="section">
Age <input type="number" id="age" value="35">
Stress <input type="number" id="stress" value="5">
Energy <input type="number" id="energy" value="6">
Calmness <input type="number" id="calmness" value="5">
<button onclick="App.generatePrescription()">Update</button>
</div>

<div class="section">
<div id="prescription"></div>
</div>

<div class="section">
<h3>Japa</h3>
<div id="count">0</div>
Target: <span id="targetDisplay">0</span><br>
<button onclick="App.tap()">Tap</button>
<button onclick="App.resetCount()">Reset</button>
</div>

<div class="section">
<h3>Guided Breath</h3>
<div id="breathCircle"></div>
<button onclick="App.startBreath()">Start Breath</button>
</div>

<div class="section">
<h3>Mantra</h3>
<button onclick="App.playMantra()">Play Om</button>
<button onclick="App.stopMantra()">Stop</button>
</div>

<div class="section">
<h3>Dashboard</h3>
SSI: <span id="ssi">0</span><br>
Streak: <span id="streak">0</span><br>
Burnout Risk: <span id="burnout">0</span>
</div>

<audio id="bellSound"
src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_3c62db7b44.mp3"
preload="auto"></audio>

<audio id="mantraAudio" loop
src="https://cdn.pixabay.com/download/audio/2021/09/07/audio_30f89b9188.mp3"
preload="auto"></audio>

<script>

const App = {

  state: {
    count: 0,
    target: 54,
    breathTime: 3,
    streak: parseInt(localStorage.getItem("streak")) || 0,
    ssi: 0,
    burnoutRisk: 0,
    breathRunning: false
  },

  generatePrescription() {

    const age = +document.getElementById("age").value;
    const stress = +document.getElementById("stress").value;
    const energy = +document.getElementById("energy").value;
    const calm = +document.getElementById("calmness").value;

    let base = 54;

    if (age > 55) base = 27;

    if (stress > 7) {
      base *= 0.6;
      this.state.breathTime = 5;
    } else {
      this.state.breathTime = 3;
    }

    if (energy < 4) base = 27;

    if (calm > 8 && this.state.streak > 5) base *= 1.2;

    if (this.state.streak % 7 === 0 && this.state.streak !== 0) {
      base = 27;
      this.state.breathTime = 5;
    }

    this.state.target = Math.round(base);

    this.state.burnoutRisk =
      Math.max(0, (this.state.target/108) + (stress/10) - (energy/10));

    this.state.ssi =
      (this.state.streak * 0.3) +
      (calm * 0.4) +
      ((10 - stress) * 0.3);

    this.updateUI();
  },

  updateUI() {
    document.getElementById("targetDisplay").innerText = this.state.target;
    document.getElementById("prescription").innerText =
      "Japa: " + this.state.target +
      " | Breath: " + this.state.breathTime + " min";

    document.getElementById("ssi").innerText =
      this.state.ssi.toFixed(2);

    document.getElementById("streak").innerText =
      this.state.streak;

    document.getElementById("burnout").innerText =
      this.state.burnoutRisk.toFixed(2);
  },

  tap() {
    this.state.count++;
    document.getElementById("count").innerText = this.state.count;

    document.getElementById("bellSound").play();

    if (this.state.count === this.state.target) {
      this.state.streak++;
      localStorage.setItem("streak", this.state.streak);
      this.updateUI();
    }
  },

  resetCount() {
    this.state.count = 0;
    document.getElementById("count").innerText = 0;
  },

  startBreath() {
    if (this.state.breathRunning) return;

    this.state.breathRunning = true;

    const circle = document.getElementById("breathCircle");
    let cycles = this.state.breathTime * 2;

    const interval = setInterval(() => {
      circle.style.transform =
        circle.style.transform === "scale(1.5)"
        ? "scale(1)"
        : "scale(1.5)";
      cycles--;

      if (cycles <= 0) {
        clearInterval(interval);
        this.state.breathRunning = false;
      }

    }, 4000);
  },

  playMantra() {
    const audio = document.getElementById("mantraAudio");
    audio.play();
  },

  stopMantra() {
    const audio = document.getElementById("mantraAudio");
    audio.pause();
    audio.currentTime = 0;
  }

};

App.generatePrescription();

</script>

</body>
</html>
